"use strict";angular.module("faeriadecks2App",["ngRoute","ngMaterial","ngSanitize","ngAnimate","ngResource"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/decks/browse",{templateUrl:"views/decks.html",controller:"DecksCtrl",controllerAs:"decks"}).when("/:deckId",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"}),b.html5Mode(!0).hashPrefix("!")}]),angular.module("faeriadecks2App").controller("MainCtrl",["Cards","Deck","$routeParams","$location",function(a,b,c,d){function e(a){var b;return g.deck.forEach(function(c){c.id===a&&(b=c)}),b}function f(a){var b;g.deck.forEach(function(c,d){c.id===a&&(b=d)}),g.deck.splice(b,1)}var g=this;g.cards=a.get(),g.deck=[],g.totalCards=0,g.deckName="",g.deckUrl="",g.colorFilters={human:!0,green:!0,yellow:!0,blue:!0,red:!0},g.typeFilters={creature:!0,event:!0,structure:!0},g.averageStat=function(a,b,c){var d=0,e=0;return g.deck.forEach(function(f){b&&f[b]!==c||(d+=f[a]*f.copies,e+=f.copies)}),isNaN(d)||isNaN(e)||!d||!e?0:Math.floor(d/e*100)/100},g.countStatValue=function(a,b){var c=0;return g.deck.forEach(function(d){b&&d[a]!==b||(c+=d.copies)}),isNaN(c)?0:c},g.highestStat=function(a){var b=0;return g.deck.forEach(function(c){c[a]>b&&(b=c[a])}),isNaN(b)?0:b},g.add=function(a){if(30!==g.totalCards){var b=e(a.id);if(b){if("LEGENDARY"===b.rarity)return;if(3===b.copies)return;return b.copies++,void g.totalCards++}var c={};for(var d in a)c[d]=a[d];c.copies=1,g.deck.push(c),g.totalCards++}},g.remove=function(a){var b=e(a.id);b.copies--,g.totalCards--,0===b.copies&&f(b.id)};var h={HUMAN:1,BLUE:2,GREEN:3,RED:4,YELLOW:5};g.colorOrder=function(a){return h[a]},g.pad=function(a){for(var b=String(a);b.length<3;)b=0+b;return b},c.deckId&&b.get({deckId:c.deckId}).$promise.then(function(a){g.deckName=a.name,g.deckUrl=a.url,g.deck=a.deck;var b=0;g.deck.forEach(function(a){b+=a.copies}),g.totalCards=b},function(){g.error="Deck could not be found."}),g.save=function(){var a=new b({name:g.deckName,deck:g.deck});a.$save().then(function(a){d.path("/"+a.url)})},g.reset=function(){c.deckId&&d.path("/"),g.deck=[],g.totalCards=0,g.deckName="",g.deckUrl=""}}]),angular.module("faeriadecks2App").filter("colorFilter",function(){return function(a,b){var c=[];return a&&b?(a.forEach(function(a){b[a.color.toLowerCase()]&&c.push(a)}),c):c}}),angular.module("faeriadecks2App").filter("typeFilter",function(){return function(a,b){var c=[];return a&&b?(a.forEach(function(a){b[a.type.toLowerCase()]&&c.push(a)}),c):c}}),angular.module("faeriadecks2App").service("Cards",["$http","$sce",function(a,b){var c={};return{get:function(){return c.cards||a.get("/scripts/output.json").then(function(a){var d=a.data;d.forEach(function(a){a.text=a.text.replace(/\{/g,"<strong>"),a.text=a.text.replace(/\}/g,"</strong>"),a.text=a.text.replace(/\_/g," "),a.text=a.text.replace(/\|/g," "),a.text=b.trustAsHtml(a.text)}),c.cards=d}),c},getById:function(a){var b;return c.cards.forEach(function(c){c.id===a&&(b=c)}),b}}}]),angular.module("faeriadecks2App").controller("RootCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){function e(a){return g(function(){c(a).toggle().then(function(){d.debug("toggle "+a+" is done")})},200)}function f(a){return function(){c(a).toggle().then(function(){d.debug("toggle "+a+" is done")})}}function g(c,d){var e;return function(){var f=a,g=Array.prototype.slice.call(arguments);b.cancel(e),e=b(function(){e=void 0,c.apply(f,g)},d||10)}}a.toggleLeft=e("left"),a.toggleRight=f("right"),a.isOpenRight=function(){return c("right").isOpen()}}]).controller("LeftCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("left").close().then(function(){d.debug("close LEFT is done")})}}]).controller("RightCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("right").close().then(function(){d.debug("close RIGHT is done")})}}]),angular.module("faeriadecks2App").service("Deck",["$resource",function(a){var b=a("/api/decks/:deckId",{deckId:"@id"},{list:{method:"GET",isArray:!0}});return b}]),angular.module("faeriadecks2App").controller("DecksCtrl",["Deck","Cards",function(a,b){var c=this;this.decks=a.list(),this.cards=b.get(),this.getById=function(a){var b;return this.cards.cards.forEach(function(c){c.id===a&&(b=c)}),b},this.getColors=function(a){if(!a||!a.deck)return[];var b=[];return a.deck.forEach(function(a){var d=c.getById(a.id);-1===b.indexOf(d.color)&&b.push(d.color)}),b},this.deckCardCount=function(a){var b=0;return a.deck.forEach(function(a){b+=a.copies}),b}}]);