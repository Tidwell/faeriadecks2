"use strict";angular.module("faeriadecks2App",["ngRoute","ngMaterial","ngSanitize","ngAnimate","ngResource","ngCookies"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/decks/browse",{templateUrl:"views/decks.html",controller:"DecksCtrl",controllerAs:"decks"}).when("/:deckId",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"}),b.html5Mode(!0).hashPrefix("!")}]),angular.module("faeriadecks2App").controller("MainCtrl",["Cards","Deck","$routeParams","$location","$cookies",function(a,b,c,d,e){function f(a){var b;return h.deck.forEach(function(c){c.id===a&&(b=c)}),b}function g(a){var b;h.deck.forEach(function(c,d){c.id===a&&(b=d)}),h.deck.splice(b,1)}var h=this;h.hasRated=!1,h.cards=a.get(),h.deck=[],h.totalCards=0,h.deckName="",h.deckUrl="",h.colorFilters={human:!0,green:!0,yellow:!0,blue:!0,red:!0},h.typeFilters={creature:!0,event:!0,structure:!0},h.averageStat=function(a,b,c){var d=0,e=0;return h.deck.forEach(function(f){b&&f[b]!==c||(d+=f[a]*f.copies,e+=f.copies)}),isNaN(d)||isNaN(e)||!d||!e?0:Math.floor(d/e*100)/100},h.countStatValue=function(a,b){var c=0;return h.deck.forEach(function(d){b&&d[a]!==b||(c+=d.copies)}),isNaN(c)?0:c},h.highestStat=function(a){var b=0;return h.deck.forEach(function(c){c[a]>b&&(b=c[a])}),isNaN(b)?0:b},h.add=function(a){if(30!==h.totalCards){var b=f(a.id);if(b){if("LEGENDARY"===b.rarity)return;if(3===b.copies)return;return b.copies++,void h.totalCards++}var c={};for(var d in a)c[d]=a[d];c.copies=1,h.deck.push(c),h.totalCards++}},h.remove=function(a){var b=f(a.id);b.copies--,h.totalCards--,0===b.copies&&g(b.id)};var i={HUMAN:1,BLUE:2,GREEN:3,RED:4,YELLOW:5};h.colorOrder=function(a){return i[a]},h.pad=function(a){for(var b=String(a);b.length<3;)b=0+b;return b},c.deckId&&b.get({deckId:c.deckId}).$promise.then(function(a){h.deckName=a.name,h.deckUrl=a.url,h.deck=a.deck,h.deckRating=a.rating.average;var b=0;h.deck.forEach(function(a){b+=a.copies}),h.totalCards=b,e.get(h.deckUrl)&&(h.hasRated=!0)},function(){h.error="Deck could not be found."}),h.save=function(){var a=new b({name:h.deckName,deck:h.deck});a.$save().then(function(a){d.path("/"+a.url)})},h.reset=function(){c.deckId&&d.path("/"),h.deck=[],h.totalCards=0,h.deckName="",h.deckUrl=""},h.submitRating=function(a){h.hasRated=!0,b.rate({rating:a,id:h.deckUrl}).$promise.then(function(){e.put(h.deckUrl,a)})}}]),angular.module("faeriadecks2App").filter("colorFilter",function(){return function(a,b){var c=[];return a&&b?(a.forEach(function(a){b[a.color.toLowerCase()]&&c.push(a)}),c):c}}),angular.module("faeriadecks2App").filter("typeFilter",function(){return function(a,b){var c=[];return a&&b?(a.forEach(function(a){b[a.type.toLowerCase()]&&c.push(a)}),c):c}}),angular.module("faeriadecks2App").service("Cards",["$http","$sce",function(a,b){var c={};return{get:function(){return c.cards||a.get("/scripts/output.json").then(function(a){var d=a.data;d.forEach(function(a){a.text=a.text.replace(/\{/g,"<strong>"),a.text=a.text.replace(/\}/g,"</strong>"),a.text=a.text.replace(/\_/g," "),a.text=a.text.replace(/\|/g," "),a.text=b.trustAsHtml(a.text)}),c.cards=d}),c},getById:function(a){var b;return c.cards.forEach(function(c){c.id===a&&(b=c)}),b}}}]),angular.module("faeriadecks2App").controller("RootCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){function e(a){return g(function(){c(a).toggle().then(function(){d.debug("toggle "+a+" is done")})},200)}function f(a){return function(){c(a).toggle().then(function(){d.debug("toggle "+a+" is done")})}}function g(c,d){var e;return function(){var f=a,g=Array.prototype.slice.call(arguments);b.cancel(e),e=b(function(){e=void 0,c.apply(f,g)},d||10)}}a.toggleLeft=e("left"),a.toggleRight=f("right"),a.isOpenRight=function(){return c("right").isOpen()}}]).controller("LeftCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("left").close().then(function(){d.debug("close LEFT is done")})}}]).controller("RightCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("right").close().then(function(){d.debug("close RIGHT is done")})}}]),angular.module("faeriadecks2App").service("Deck",["$resource",function(a){var b="",c=a(b+"/api/decks/:deckId",{deckId:"@id",rating:"@rating"},{list:{method:"GET",isArray:!0},topList:{method:"GET",isArray:!0,url:b+"/api/decks/top"},rate:{method:"POST",url:b+"/api/decks/:deckId/rate/:rating"}});return c}]),angular.module("faeriadecks2App").controller("DecksCtrl",["Deck","Cards",function(a,b){var c=this;this.recentDecks=a.list(),this.topDecks=a.topList(),this.cards=b.get(),this.getById=function(a){var b;return this.cards.cards.forEach(function(c){c.id===a&&(b=c)}),b},this.getColors=function(a){if(!a||!a.deck)return[];var b=[];return a.deck.forEach(function(a){var d=c.getById(a.id);-1===b.indexOf(d.color)&&b.push(d.color)}),b},this.deckCardCount=function(a){var b=0;return a.deck.forEach(function(a){b+=a.copies}),b}}]),angular.module("faeriadecks2App").directive("starRating",function(){return{restrict:"EA",template:'<ul class="star-rating" ng-class="{readonly: isReadonly}">  <li ng-repeat="star in stars" class="star" ng-class="{filled: star.filled}" ng-click="toggle($index)">    <i class="fa fa-star"></i>  </li></ul>',scope:{ratingValue:"=ngModel",max:"=?",onRatingSelect:"&?",isReadonly:"=?"},link:function(a,b,c){function d(){a.stars=[];for(var b=0;b<a.max;b++)a.stars.push({filled:b<a.ratingValue})}a.max||(a.max=5),a.toggle=function(b){if(!a.isReadonly){if(a.ratingValue=b+1,!a.onRatingSelect)return;a.onRatingSelect({rating:b+1})}},a.$watch("ratingValue",function(a,b){d()})}}});